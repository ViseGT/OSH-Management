<!DOCTYPE html>

<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è·å®‰è¡›æ¨å‡é …ç›®ç®¡ç†ç³»çµ±</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&family=Noto+Sans+TC:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
:root {
  --white:#ffffff;--off:#f5f5f3;--gray-50:#f3f3f1;--gray-100:#eaeae8;
  --gray-200:#d5d5d3;--gray-300:#b5b5b2;--gray-400:#888886;--gray-500:#5a5a58;
  --black:#0f0f0e;--ink:#1c1c1a;--ink2:#2c2c2a;
  --red:#c0112e;--red-dark:#96091f;--red-pale:#fef1f3;--red-tint:#fadddf;
  --orange:#b84e00;--orange-pale:#fef5ee;--orange-tint:#fbd9be;
  --green:#16603a;--green-pale:#f0faf5;--green-tint:#c8e8d6;
  --blue:#0e3d9e;--blue-pale:#f0f4fd;--blue-tint:#c4d4f2;
  --purple:#5b21b6;--purple-pale:#f5f3ff;--purple-tint:#ddd6fe;
  --shadow-sm:0 1px 3px rgba(0,0,0,.07);
  --shadow:0 2px 8px rgba(0,0,0,.08);
  --shadow-md:0 4px 16px rgba(0,0,0,.09);
  --sans:'Noto Sans TC',sans-serif;--serif:'Noto Serif TC',serif;--mono:'IBM Plex Mono',monospace;
  --r:4px;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:var(--sans);background:var(--off);color:var(--ink);min-height:100vh;-webkit-font-smoothing:antialiased;font-size:14px;line-height:1.6}
::-webkit-scrollbar{width:5px;height:5px}::-webkit-scrollbar-track{background:var(--gray-100)}::-webkit-scrollbar-thumb{background:var(--gray-300);border-radius:3px}

/* LOGIN */
#login-screen{position:fixed;inset:0;z-index:9999;background:var(â€“off);display:flex;align-items:center;justify-content:center;padding:20px}
.login-wrap{display:grid;grid-template-columns:360px 1fr;max-width:800px;width:100%;border:2px solid var(â€“black);background:var(â€“white);box-shadow:8px 8px 0 var(â€“red);animation:lIn .35s cubic-bezier(.22,1,.36,1)}
@keyframes lIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
.login-left{background:var(â€“black);padding:48px 40px;display:flex;flex-direction:column;justify-content:space-between;position:relative;overflow:hidden}
.login-left::before{content:â€™â€™;position:absolute;bottom:-50px;right:-50px;width:200px;height:200px;border:36px solid var(â€“red);border-radius:50%;opacity:.12}
.login-left::after{content:â€™â€™;position:absolute;top:0;left:0;right:0;height:4px;background:var(â€“red)}
.l-brand{display:flex;align-items:center;gap:12px;margin-bottom:36px}
.l-brand-icon{width:40px;height:40px;border:2px solid var(â€“red);display:flex;align-items:center;justify-content:center;font-size:18px}
.l-brand-name{font-family:var(â€“serif);font-size:13px;font-weight:700;color:var(â€“white);line-height:1.3;letter-spacing:.02em}
.l-headline{font-family:var(â€“serif);font-size:22px;font-weight:700;line-height:1.4;color:var(â€“white);margin-bottom:14px}
.l-headline em{color:var(â€“red);font-style:normal}
.l-tagline{font-size:12px;color:var(â€“gray-400);line-height:1.75}
.l-foot{font-size:10px;color:var(â€“gray-500);letter-spacing:.04em;margin-top:auto;padding-top:28px}
.login-right{padding:44px 40px;display:flex;flex-direction:column;justify-content:center}
.lr-title{font-family:var(â€“serif);font-size:18px;font-weight:700;color:var(â€“ink);margin-bottom:4px}
.lr-sub{font-size:12px;color:var(â€“gray-400);margin-bottom:28px}
.l-tabs{display:flex;border:2px solid var(â€“black);margin-bottom:24px}
.l-tab{flex:1;padding:9px;font-size:11px;font-weight:700;cursor:pointer;border:none;background:transparent;color:var(â€“gray-400);font-family:var(â€“sans);transition:all .15s;letter-spacing:.06em;text-transform:uppercase}
.l-tab.active{background:var(â€“black);color:var(â€“white)}
.l-tab:not(.active):hover{background:var(â€“gray-50)}
.lf-guest,.lf-admin{display:none}.lf-guest.show,.lf-admin.show{display:block}
.perm-box{border:1px solid var(â€“gray-200);border-left:3px solid var(â€“black);padding:13px 15px;margin-bottom:22px;background:var(â€“gray-50)}
.perm-box-title{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:var(â€“gray-400);margin-bottom:9px}
.perm-item{font-size:12px;color:var(â€“gray-500);display:flex;align-items:center;gap:8px;padding:2px 0}
.perm-item.ok::before{content:â€˜âœ“â€™;color:var(â€“green);font-weight:700;width:10px}
.perm-item.no::before{content:â€˜âœ—â€™;color:var(â€“red);font-weight:700;width:10px}
.ff{margin-bottom:14px}
.ff label{display:block;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.07em;color:var(â€“gray-400);margin-bottom:5px}
.ff input{width:100%;border:2px solid var(â€“gray-200);background:var(â€“white);color:var(â€“ink);font-family:var(â€“sans);font-size:13px;padding:9px 12px;outline:none;transition:border-color .15s;border-radius:var(â€“r)}
.ff input:focus{border-color:var(â€“black)}
.l-err{border-left:3px solid var(â€“red);background:var(â€“red-pale);padding:9px 13px;font-size:12px;color:var(â€“red);margin-bottom:12px;display:none}
.l-err.show{display:block}
.l-btn{width:100%;padding:12px;border:2px solid var(â€“black);background:var(â€“black);color:var(â€“white);font-family:var(â€“sans);font-size:11px;font-weight:700;cursor:pointer;transition:all .15s;letter-spacing:.06em;text-transform:uppercase;border-radius:var(â€“r)}
.l-btn:hover{background:var(â€“ink2)}
.l-btn.guest{background:var(â€“white);color:var(â€“black)}.l-btn.guest:hover{background:var(â€“gray-50)}
.l-btn.admin{background:var(â€“red);border-color:var(â€“red)}.l-btn.admin:hover{background:var(â€“red-dark);border-color:var(â€“red-dark)}

/* NAV */
.nav{position:fixed;top:0;left:0;right:0;z-index:1000;height:58px;background:var(â€“white);border-bottom:1px solid var(â€“gray-200);display:flex;align-items:stretch;box-shadow:var(â€“shadow-sm)}
.nav-brand{display:flex;align-items:center;gap:11px;padding:0 22px;border-right:1px solid var(â€“gray-200);background:var(â€“black);min-width:200px}
.nb-icon{width:26px;height:26px;border:1.5px solid var(â€“red);display:flex;align-items:center;justify-content:center;font-size:12px}
.nb-text{font-family:var(â€“serif);font-size:13px;font-weight:700;color:var(â€“white);line-height:1.2}
.nb-sub{font-size:9px;color:var(â€“gray-400);letter-spacing:.04em}
.nav-tabs{display:flex;align-items:stretch;flex:1;padding-left:4px}
.nav-tab{display:flex;align-items:center;padding:0 16px;font-size:11px;font-weight:700;color:var(â€“gray-400);cursor:pointer;border:none;background:none;font-family:var(â€“sans);border-bottom:3px solid transparent;transition:all .15s;letter-spacing:.05em;text-transform:uppercase;white-space:nowrap}
.nav-tab:hover{color:var(â€“ink);background:var(â€“gray-50)}
.nav-tab.active{color:var(â€“red);border-bottom-color:var(â€“red)}
.nav-tab.admin-only{display:none}
.nav-right{display:flex;align-items:stretch;margin-left:auto;border-left:1px solid var(â€“gray-200)}
.nav-role{display:flex;align-items:center;gap:7px;padding:0 16px;font-size:10px;font-weight:700;letter-spacing:.06em;text-transform:uppercase;color:var(â€“gray-400);border-right:1px solid var(â€“gray-200)}
.nav-role .dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.nav-role.admin{color:var(â€“red)}.nav-role.admin .dot{background:var(â€“red)}
.nav-role.guest .dot{background:var(â€“gray-300)}
.nav-logout{height:100%;padding:0 16px;border:none;background:transparent;font-family:var(â€“sans);font-size:10px;font-weight:700;color:var(â€“gray-400);cursor:pointer;transition:all .15s;letter-spacing:.05em;text-transform:uppercase}
.nav-logout:hover{background:var(â€“red-pale);color:var(â€“red)}

/* LAYOUT */
.main{padding-top:58px;min-height:100vh;display:none}.main.visible{display:block}
.page{display:none;padding:0 0 80px}.page.active{display:block}
.page-banner{background:var(â€“white);border-bottom:1px solid var(â€“gray-200);padding:24px 32px 20px;display:flex;align-items:flex-end;justify-content:space-between;gap:20px}
.pb-left{display:flex;align-items:flex-start;gap:14px}
.pb-bar{width:4px;min-height:44px;background:var(â€“red);flex-shrink:0}
.pb-eye{font-size:10px;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(â€“red);margin-bottom:3px}
.pb-title{font-family:var(â€“serif);font-size:20px;font-weight:700;color:var(â€“ink);letter-spacing:.02em}
.pb-sub{font-size:11px;color:var(â€“gray-400);margin-top:2px}
.pb-actions{display:flex;gap:9px;align-items:center;flex-shrink:0}
.content{padding:24px 32px}

/* STATS */
.stats-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:0;margin-bottom:24px;border:2px solid var(â€“black);overflow:hidden}
.stat-card{background:var(â€“white);padding:18px 16px 14px;border-right:1px solid var(â€“black);position:relative;transition:background .12s;cursor:pointer}
.stat-card:last-child{border-right:none}
.stat-card::before{content:â€™â€™;position:absolute;top:0;left:0;right:0;height:3px}
.stat-card.s-total::before{background:var(â€“black)}
.stat-card.s-exec::before{background:var(â€“green)}
.stat-card.s-pending::before{background:var(â€“orange)}
.stat-card.s-dev::before{background:var(â€“blue)}
.stat-card.s-plan::before{background:var(â€“purple)}
.stat-card:hover{background:var(â€“gray-50)}
.stat-num{font-family:var(â€“mono);font-size:32px;font-weight:600;line-height:1;margin:4px 0 7px}
.stat-card.s-total .stat-num{color:var(â€“black)}
.stat-card.s-exec .stat-num{color:var(â€“green)}
.stat-card.s-pending .stat-num{color:var(â€“orange)}
.stat-card.s-dev .stat-num{color:var(â€“blue)}
.stat-card.s-plan .stat-num{color:var(â€“purple)}
.stat-label{font-size:10px;font-weight:700;letter-spacing:.07em;text-transform:uppercase;color:var(â€“gray-400)}

/* AXIS TABS */
.axis-tabs{display:flex;gap:0;margin-bottom:20px;border:1px solid var(â€“gray-200);background:var(â€“white);overflow:hidden}
.axis-tab{flex:1;padding:10px 8px;font-size:11px;font-weight:700;cursor:pointer;border:none;background:transparent;color:var(â€“gray-400);font-family:var(â€“sans);transition:all .15s;border-right:1px solid var(â€“gray-200);letter-spacing:.03em;text-align:center}
.axis-tab:last-child{border-right:none}
.axis-tab.active{background:var(â€“black);color:var(â€“white)}
.axis-tab:not(.active):hover{background:var(â€“gray-50);color:var(â€“ink)}

/* FILTER BAR */
.filter-bar{background:var(â€“white);border:1px solid var(â€“gray-200);padding:11px 16px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:18px}
.filter-bar input,.filter-bar select{background:var(â€“white);border:1px solid var(â€“gray-200);color:var(â€“ink);font-family:var(â€“sans);font-size:12px;padding:6px 10px;outline:none;transition:border-color .15s;-webkit-appearance:none;border-radius:var(â€“r)}
.filter-bar input:focus,.filter-bar select:focus{border-color:var(â€“black)}
.filter-bar input{width:200px}
.filter-bar select{cursor:pointer;padding-right:22px;background-image:url(â€œdata:image/svg+xml,%3Csvg xmlns=â€˜http://www.w3.org/2000/svgâ€™ width=â€˜10â€™ height=â€˜6â€™ viewBox=â€˜0 0 10 6â€™%3E%3Cpath d=â€˜M1 1l4 4 4-4â€™ stroke=â€™%23888886â€™ stroke-width=â€˜1.5â€™ fill=â€˜noneâ€™ stroke-linecap=â€˜roundâ€™/%3E%3C/svg%3Eâ€);background-repeat:no-repeat;background-position:right 8px center}
.fl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.07em;color:var(â€“gray-400)}
.fdiv{width:1px;height:18px;background:var(â€“gray-200);flex-shrink:0}
.filter-count{margin-left:auto;font-size:11px;color:var(â€“gray-400)}
.filter-count b{color:var(â€“black);font-family:var(â€“mono)}

/* BUTTONS */
.btn{border:none;font-family:var(â€“sans);font-size:10px;font-weight:700;padding:8px 16px;cursor:pointer;transition:all .12s;display:inline-flex;align-items:center;gap:7px;white-space:nowrap;letter-spacing:.06em;text-transform:uppercase;border-radius:var(â€“r)}
.btn-blk{background:var(â€“black);color:var(â€“white);border:2px solid var(â€“black)}.btn-blk:hover{background:var(â€“ink2)}
.btn-red{background:var(â€“red);color:var(â€“white);border:2px solid var(â€“red)}.btn-red:hover{background:var(â€“red-dark)}
.btn-xls{background:var(â€“white);color:var(â€“green);border:2px solid var(â€“green)}.btn-xls:hover{background:var(â€“green-pale)}
.btn-ghost{background:var(â€“white);color:var(â€“gray-500);border:1px solid var(â€“gray-200)}.btn-ghost:hover{border-color:var(â€“black);color:var(â€“ink)}
.btn-sm{padding:5px 12px;font-size:9px}
.bti{width:28px;height:28px;padding:0;font-size:12px;display:inline-flex;align-items:center;justify-content:center;border:1px solid var(â€“gray-200);background:var(â€“white);cursor:pointer;transition:all .12s;border-radius:var(â€“r)}
.bti:hover{border-color:var(â€“black)}
.bti.e:hover{border-color:var(â€“blue);background:var(â€“blue-pale)}
.bti.d:hover{border-color:var(â€“red);background:var(â€“red-pale)}

/* CARDS GRID */
.items-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(360px,1fr));gap:1px;background:var(â€“gray-200)}
.sec-div{grid-column:1/-1;display:flex;align-items:center;gap:12px;padding:16px 0 6px;background:transparent}
.sec-bar{width:3px;height:13px;flex-shrink:0}
.sec-lbl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;white-space:nowrap}
.sec-line{flex:1;height:1px;background:var(â€“gray-200)}
.sec-cnt{font-size:10px;font-weight:700;font-family:var(â€“mono);color:var(â€“gray-400)}

/* ITEM CARD */
.item-card{background:var(â€“white);display:flex;flex-direction:column;transition:box-shadow .18s;position:relative}
.item-card:hover{box-shadow:var(â€“shadow-md);z-index:1}
.card-head{display:flex;align-items:stretch;border-bottom:1px solid var(â€“gray-100)}
.card-ab{width:4px;flex-shrink:0}
.card-ab.s-åŸ·è¡Œä¸­{background:var(â€“green)}
.card-ab.s-å¾…é–‹ç™¼ä¸­{background:var(â€“blue)}
.card-ab.s-è¦åŠƒä¸­{background:var(â€“purple)}
.card-ab.s-æš«åœ{background:var(â€“orange)}
.card-ab.s-å®Œæˆ{background:var(â€“gray-300)}
.card-hc{flex:1;display:flex;align-items:center;justify-content:space-between;padding:10px 13px 10px 12px;gap:8px;min-height:50px}
.card-id{font-family:var(â€“mono);font-size:11px;font-weight:600;color:var(â€“gray-400);flex-shrink:0;background:var(â€“gray-50);padding:2px 7px;border:1px solid var(â€“gray-200);border-radius:2px}
.card-title{font-size:13px;font-weight:600;color:var(â€“ink);line-height:1.4;flex:1;padding:0 8px}
.schip{flex-shrink:0;border-radius:2px;font-size:9px;font-weight:700;padding:3px 7px;white-space:nowrap;letter-spacing:.04em}
.sc-åŸ·è¡Œä¸­{background:var(â€“green-tint);color:var(â€“green);border:1px solid var(â€“green)}
.sc-å¾…é–‹ç™¼ä¸­{background:var(â€“blue-tint);color:var(â€“blue);border:1px solid var(â€“blue)}
.sc-è¦åŠƒä¸­{background:var(â€“purple-tint);color:var(â€“purple);border:1px solid var(â€“purple)}
.sc-æš«åœ{background:var(â€“orange-tint);color:var(â€“orange);border:1px solid var(â€“orange)}
.sc-å®Œæˆ{background:var(â€“gray-100);color:var(â€“gray-400);border:1px solid var(â€“gray-200)}
.card-body{padding:12px 13px 12px 16px;flex:1}
.card-axis{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.05em;color:var(â€“red);margin-bottom:8px;display:flex;align-items:center;gap:6px}
.card-axis::before{content:â€™â€™;width:3px;height:3px;border-radius:50%;background:var(â€“red);flex-shrink:0}
.card-meta{display:grid;grid-template-columns:1fr 1fr;gap:8px 12px;margin-bottom:10px}
.mi{display:flex;flex-direction:column;gap:2px}
.mk{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.07em;color:var(â€“gray-300)}
.mv{font-size:12px;color:var(â€“ink);font-weight:500;line-height:1.4}
.card-detail{margin-bottom:8px}
.cd-label{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:var(â€“gray-300);margin-bottom:3px}
.cd-val{font-size:12px;color:var(â€“gray-500);line-height:1.6;border-left:2px solid var(â€“gray-200);padding-left:8px}
.cd-val.highlight{border-left-color:var(â€“blue);background:var(â€“blue-pale);padding:4px 8px;color:var(â€“blue)}
.card-notes{font-size:11px;color:var(â€“gray-400);margin-top:8px;padding-top:8px;border-top:1px dashed var(â€“gray-200);line-height:1.65}
.card-foot{display:flex;align-items:center;justify-content:space-between;padding:8px 13px 8px 16px;border-top:1px solid var(â€“gray-100);background:var(â€“gray-50)}
.owner-tag{font-size:11px;font-weight:700;color:var(â€“ink);background:var(â€“white);border:1px solid var(â€“gray-200);padding:3px 9px;border-radius:2px}
.card-acts{display:flex;gap:5px}

/* EMPTY */
.empty-s{grid-column:1/-1;text-align:center;padding:60px 20px;background:var(â€“white)}
.empty-s-icon{font-size:32px;opacity:.2;margin-bottom:10px;display:block;font-family:var(â€“mono)}
.empty-s-text{font-size:12px;color:var(â€“gray-400)}

/* TABLE */
.admin-toolbar{display:flex;align-items:center;gap:9px;margin-bottom:14px;flex-wrap:wrap}
.table-wrap{border:1px solid var(â€“gray-200);background:var(â€“white);overflow:hidden;overflow-x:auto}
table{width:100%;border-collapse:collapse;min-width:1200px}
thead tr{background:var(â€“black)}
thead th{padding:9px 12px;text-align:left;font-size:9px;font-weight:700;color:var(â€“gray-300);text-transform:uppercase;letter-spacing:.08em;white-space:nowrap}
thead th:first-child{border-left:3px solid var(â€“red)}
tbody tr{border-bottom:1px solid var(â€“gray-100);transition:background .1s}
tbody tr:last-child{border-bottom:none}
tbody tr:hover{background:var(â€“gray-50)}
tbody td{padding:9px 12px;font-size:12px;vertical-align:top}
tbody td:first-child{border-left:3px solid transparent}
tbody tr:hover td:first-child{border-left-color:var(â€“red)}
.td-id{font-family:var(â€“mono);font-size:11px;color:var(â€“gray-400);white-space:nowrap}
.td-axis{font-size:11px;color:var(â€“red);font-weight:600;max-width:100px;line-height:1.4}
.td-push{font-size:11px;color:var(â€“ink);font-weight:600;max-width:110px;line-height:1.4}
.td-title{font-weight:600;max-width:160px;line-height:1.4;font-size:12px}
.td-point{font-size:11px;color:var(â€“gray-500);max-width:200px;line-height:1.5}
.td-mech{font-size:11px;color:var(â€“gray-500);max-width:150px;line-height:1.5}
.td-owner{display:inline-block;border:1px solid var(â€“gray-200);padding:2px 7px;font-size:10px;font-weight:700;background:var(â€“gray-50);color:var(â€“ink);border-radius:2px;white-space:nowrap}
.td-acts{display:flex;gap:5px;white-space:nowrap}
.td-notes{font-size:10px;color:var(â€“gray-400);max-width:150px;line-height:1.5}

/* LOG */
.log-wrap{background:var(â€“white);border:1px solid var(â€“gray-200);max-width:700px}
.log-hdr{padding:13px 18px;border-bottom:1px solid var(â€“gray-200)}
.log-hdr-lbl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.07em;color:var(â€“gray-400)}
.log-body{padding:0 18px}
.log-item{display:flex;align-items:flex-start;gap:12px;padding:10px 0;border-bottom:1px solid var(â€“gray-100)}
.log-item:last-child{border-bottom:none}
.log-dot{width:8px;height:8px;border-radius:50%;margin-top:5px;flex-shrink:0;border:1.5px solid}
.log-dot.add{background:var(â€“green-tint);border-color:var(â€“green)}
.log-dot.edit{background:var(â€“blue-tint);border-color:var(â€“blue)}
.log-dot.del{background:var(â€“red-tint);border-color:var(â€“red)}
.log-msg{font-size:13px;color:var(â€“ink)}
.log-time{font-size:10px;color:var(â€“gray-300);font-family:var(â€“mono);margin-top:2px}

/* MODAL */
.modal-overlay{position:fixed;inset:0;z-index:2000;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:20px}
.modal-overlay.open{display:flex}
.modal{background:var(â€“white);border:2px solid var(â€“black);width:100%;max-width:680px;max-height:92vh;overflow-y:auto;box-shadow:6px 6px 0 var(â€“red);animation:mIn .22s cubic-bezier(.22,1,.36,1)}
@keyframes mIn{from{opacity:0;transform:scale(.96) translateY(14px)}to{opacity:1;transform:none}}
.modal-header{display:flex;align-items:stretch;border-bottom:1px solid var(â€“gray-200)}
.m-bar{width:4px;background:var(â€“red);flex-shrink:0}
.m-title{font-family:var(â€“serif);font-size:15px;font-weight:700;padding:0 18px;display:flex;align-items:center;flex:1;color:var(â€“ink)}
.m-close{width:52px;border-left:1px solid var(â€“gray-200);background:transparent;border-top:none;border-right:none;border-bottom:none;color:var(â€“gray-400);font-size:17px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .12s;height:52px;flex-shrink:0}
.m-close:hover{background:var(â€“red-pale);color:var(â€“red)}
.modal-body{padding:24px}
.modal-footer{padding:14px 24px;border-top:1px solid var(â€“gray-200);display:flex;justify-content:flex-end;gap:9px;background:var(â€“gray-50)}

/* FORM */
.fg{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.fgrp{display:flex;flex-direction:column;gap:5px}
.fgrp.full{grid-column:1/-1}
.flbl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.07em;color:var(â€“gray-500)}
.flbl .req{color:var(â€“red)}
.finput,.fsel,.ftextarea{background:var(â€“white);border:1px solid var(â€“gray-200);color:var(â€“ink);font-family:var(â€“sans);font-size:13px;padding:8px 11px;outline:none;width:100%;transition:border-color .12s;-webkit-appearance:none;border-radius:var(â€“r)}
.finput:focus,.fsel:focus,.ftextarea:focus{border-color:var(â€“black)}
.ftextarea{resize:vertical;min-height:72px}
.fsel{background-image:url(â€œdata:image/svg+xml,%3Csvg xmlns=â€˜http://www.w3.org/2000/svgâ€™ width=â€˜10â€™ height=â€˜6â€™ viewBox=â€˜0 0 10 6â€™%3E%3Cpath d=â€˜M1 1l4 4 4-4â€™ stroke=â€™%23888886â€™ stroke-width=â€˜1.5â€™ fill=â€˜noneâ€™ stroke-linecap=â€˜roundâ€™/%3E%3C/svg%3Eâ€);background-repeat:no-repeat;background-position:right 9px center;padding-right:28px;cursor:pointer}
.fsec{grid-column:1/-1;border-top:1px solid var(â€“gray-100);padding-top:12px;margin-top:2px;font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:var(â€“gray-300)}

/* SETTINGS */
.sp{background:var(â€“white);border:1px solid var(â€“gray-200);max-width:460px}
.sp-hdr{background:var(â€“black);padding:14px 20px;display:flex;align-items:center;gap:9px}
.sp-hdr-title{font-family:var(â€“serif);font-size:14px;font-weight:700;color:var(â€“white)}
.sp-body{padding:20px}
.sp-body p{font-size:12px;color:var(â€“gray-400);margin-bottom:16px;line-height:1.7}
.pw-err{border-left:3px solid var(â€“red);background:var(â€“red-pale);padding:8px 12px;font-size:12px;color:var(â€“red);margin-bottom:12px;display:none}
.pw-err.show{display:block}

/* CONFIRM */
.cmsg{font-size:15px;font-weight:600;color:var(â€“ink);margin-bottom:7px;font-family:var(â€“serif)}
.csub{font-size:12px;color:var(â€“gray-400);line-height:1.6}
.cwarn{background:var(â€“red-pale);border-left:3px solid var(â€“red);padding:9px 13px;margin-top:14px;font-size:12px;color:var(â€“red);line-height:1.6}

/* GUEST NOTICE */
.guest-notice{background:var(â€“off);border:1px solid var(â€“gray-200);border-left:4px solid var(â€“black);padding:11px 16px;display:flex;align-items:center;gap:12px;margin-bottom:20px}
.gn-text{font-size:12px;color:var(â€“gray-500);line-height:1.6}
.gn-text b{color:var(â€“ink)}.gn-text .lnk{color:var(â€“red);cursor:pointer;text-decoration:underline}

/* TOAST */
.toast-wrap{position:fixed;bottom:24px;right:24px;z-index:9999;display:flex;flex-direction:column;gap:7px}
.toast{background:var(â€“ink);color:var(â€“white);border-left:4px solid var(â€“gray-400);padding:10px 15px;font-size:12px;display:flex;align-items:center;gap:9px;box-shadow:var(â€“shadow-md);animation:tIn .22s ease;min-width:240px;border-radius:var(â€“r)}
@keyframes tIn{from{opacity:0;transform:translateX(16px)}to{opacity:1;transform:none}}
.toast.success{border-left-color:var(â€“green)}.toast.error{border-left-color:var(â€“red)}.toast.info{border-left-color:var(â€“blue)}
.ti{font-family:var(â€“mono);font-weight:700;font-size:13px;flex-shrink:0}

@media(max-width:900px){.stats-grid{grid-template-columns:repeat(3,1fr)}.items-grid{grid-template-columns:1fr}.content{padding:16px}.page-banner{padding:16px}.fg{grid-template-columns:1fr}.login-wrap{grid-template-columns:1fr}.login-left{display:none}.axis-tabs{flex-wrap:wrap}}
</style>

</head>
<body>

<!-- LOGIN -->

<div id="login-screen">
  <div class="login-wrap">
    <div class="login-left">
      <div>
        <div class="l-brand">
          <div class="l-brand-icon">ğŸ›¡ï¸</div>
          <div>
            <div class="l-brand-name">è·å®‰è¡›æ¨å‡é …ç›®ç®¡ç†ç³»çµ±</div>
            <div style="font-size:9px;color:var(--gray-500);margin-top:1px;letter-spacing:.05em">OSH INITIATIVE TRACKING SYSTEM</div>
          </div>
        </div>
        <div class="l-headline">ç³»çµ±åŒ–è¿½è¹¤<br><em>æ¯ä¸€é …å®‰å…¨æ¨å‡é …ç›®</em></div>
        <div class="l-tagline">æ•´åˆäº”å¤§è»¸å‘è­°é¡Œï¼Œå³æ™‚æŒæ¡å„é …ç›®åŸ·è¡Œç‹€æ…‹ã€<br>è² è²¬äººèˆ‡æŸ¥æ ¸æ©Ÿåˆ¶ï¼Œå…¨é¢å¼·åŒ–å·¥å®‰ç®¡ç†èƒ½åŠ›ã€‚</div>
      </div>
      <div class="l-foot">OSH INITIATIVE MANAGEMENT Â· ENTERPRISE EDITION</div>
    </div>
    <div class="login-right">
      <div class="lr-title">é€²å…¥ç³»çµ±</div>
      <div class="lr-sub">è«‹é¸æ“‡èº«ä»½å¾Œç¹¼çºŒ</div>
      <div class="l-tabs">
        <button class="l-tab active" onclick="switchTab('guest')">è¨ªå®¢ç€è¦½</button>
        <button class="l-tab" onclick="switchTab('admin')">ç®¡ç†å“¡</button>
      </div>
      <div class="lf-guest show" id="lf-guest">
        <div class="perm-box">
          <div class="perm-box-title">è¨ªå®¢æ¬Šé™èªªæ˜</div>
          <div class="perm-item ok">ç€è¦½æ‰€æœ‰æ¨å‡é …ç›®èˆ‡ç‹€æ…‹</div>
          <div class="perm-item ok">ä¾äº”å¤§è»¸å‘/Owner/ç‹€æ…‹ç¯©é¸</div>
          <div class="perm-item ok">åŒ¯å‡º Excel å ±è¡¨</div>
          <div class="perm-item no">æ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤é …ç›®</div>
          <div class="perm-item no">ç®¡ç†å¾Œå°èˆ‡æ“ä½œè¨˜éŒ„</div>
        </div>
        <button class="l-btn guest" onclick="enterAsGuest()">ä»¥è¨ªå®¢èº«ä»½é€²å…¥</button>
      </div>
      <div class="lf-admin" id="lf-admin">
        <div class="ff">
          <label>ç®¡ç†å“¡å¯†ç¢¼</label>
          <input type="password" id="admin-pw-input" placeholder="è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼" onkeydown="if(event.key==='Enter')doLogin()">
        </div>
        <div class="l-err" id="login-error">å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥ã€‚</div>
        <button class="l-btn admin" onclick="doLogin()">ç™»å…¥ç®¡ç†å¾Œå°</button>
      </div>
    </div>
  </div>
</div>

<!-- NAV -->

<nav class="nav" id="main-nav">
  <div class="nav-brand">
    <div class="nb-icon">ğŸ›¡ï¸</div>
    <div>
      <div class="nb-text">è·å®‰è¡›æ¨å‡ç®¡ç†</div>
      <div class="nb-sub">OSH INITIATIVE TRACKING</div>
    </div>
  </div>
  <div class="nav-tabs">
    <button class="nav-tab active" onclick="showPage('dashboard')">é …ç›®ç¸½è¦½</button>
    <button class="nav-tab admin-only" onclick="showPage('admin')">ç®¡ç†å¾Œå°</button>
    <button class="nav-tab admin-only" onclick="showPage('log')">æ“ä½œè¨˜éŒ„</button>
    <button class="nav-tab admin-only" onclick="showPage('settings')">ç³»çµ±è¨­å®š</button>
  </div>
  <div class="nav-right">
    <div class="nav-role guest" id="role-badge"><span class="dot"></span><span id="role-lbl">è¨ªå®¢</span></div>
    <button class="nav-logout" onclick="logout()">ç™»å‡º</button>
  </div>
</nav>

<div class="main" id="main-app">

  <!-- DASHBOARD -->

  <div id="page-dashboard" class="page active">
    <div class="page-banner">
      <div class="pb-left">
        <div class="pb-bar"></div>
        <div><div class="pb-eye">Dashboard</div><div class="pb-title">æ¨å‡é …ç›®ç¸½è¦½</div><div class="pb-sub" id="todayLabel"></div></div>
      </div>
      <div class="pb-actions">
        <button class="btn btn-xls" onclick="exportExcel()">â†“ åŒ¯å‡º Excel</button>
        <button class="btn btn-blk" id="btn-add" onclick="openAddModal()" style="display:none">ï¼‹ æ–°å¢é …ç›®</button>
      </div>
    </div>
    <div class="content">
      <div class="guest-notice" id="guest-notice" style="display:none">
        <span style="font-size:14px;color:var(--gray-400)">â„¹</span>
        <div class="gn-text">æ‚¨ç›®å‰ä»¥<b>è¨ªå®¢èº«ä»½</b>ç€è¦½ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰é …ç›®ä¸¦åŒ¯å‡ºå ±è¡¨ï¼Œä½†ç„¡æ³•æ–°å¢æˆ–ä¿®æ”¹é …ç›®ã€‚å¦‚éœ€æ“ä½œï¼Œè«‹<span class="lnk" onclick="logout()">é‡æ–°ç™»å…¥ç‚ºç®¡ç†å“¡</span>ã€‚</div>
      </div>
      <div class="stats-grid">
        <div class="stat-card s-total" onclick="filterByStatus('')"><div class="stat-num" id="s-total">0</div><div class="stat-label">é …ç›®ç¸½æ•¸</div></div>
        <div class="stat-card s-exec" onclick="filterByStatus('åŸ·è¡Œä¸­')"><div class="stat-num" id="s-exec">0</div><div class="stat-label">åŸ·è¡Œä¸­</div></div>
        <div class="stat-card s-pending" onclick="filterByStatus('å¾…é–‹ç™¼ä¸­')"><div class="stat-num" id="s-pending">0</div><div class="stat-label">å¾…é–‹ç™¼ä¸­</div></div>
        <div class="stat-card s-dev" onclick="filterByStatus('è¦åŠƒä¸­')"><div class="stat-num" id="s-dev">0</div><div class="stat-label">è¦åŠƒä¸­</div></div>
        <div class="stat-card s-plan" onclick="filterByStatus('å®Œæˆ')"><div class="stat-num" id="s-plan">0</div><div class="stat-label">å®Œæˆ</div></div>
      </div>
      <div class="axis-tabs" id="axis-tabs">
        <button class="axis-tab active" onclick="filterByAxis('')">å…¨éƒ¨è»¸å‘</button>
      </div>
      <div class="filter-bar">
        <span class="fl">ç¯©é¸</span><div class="fdiv"></div>
        <input type="text" id="db-search" placeholder="æœå°‹é …ç›®åç¨±ã€é‡é»â€¦" oninput="renderDashboard()">
        <select id="db-owner" onchange="renderDashboard()"><option value="">å…¨éƒ¨ Owner</option></select>
        <select id="db-status" onchange="renderDashboard()">
          <option value="">å…¨éƒ¨ç‹€æ…‹</option>
          <option value="åŸ·è¡Œä¸­">åŸ·è¡Œä¸­</option>
          <option value="å¾…é–‹ç™¼ä¸­">å¾…é–‹ç™¼ä¸­</option>
          <option value="è¦åŠƒä¸­">è¦åŠƒä¸­</option>
          <option value="å®Œæˆ">å®Œæˆ</option>
          <option value="æš«åœ">æš«åœ</option>
        </select>
        <button class="btn btn-ghost btn-sm" onclick="resetFilters()">é‡ç½®</button>
        <div class="filter-count">é¡¯ç¤º <b id="db-count">0</b> / <b id="db-total">0</b> é …</div>
      </div>
      <div class="items-grid" id="dashboard-grid"></div>
    </div>
  </div>

  <!-- ADMIN -->

  <div id="page-admin" class="page">
    <div class="page-banner">
      <div class="pb-left"><div class="pb-bar"></div><div><div class="pb-eye">Administration</div><div class="pb-title">ç®¡ç†å¾Œå°</div><div class="pb-sub">æ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤æ¨å‡é …ç›®</div></div></div>
      <div class="pb-actions">
        <button class="btn btn-xls" onclick="exportExcel()">â†“ åŒ¯å‡º Excel</button>
        <button class="btn btn-blk" onclick="openAddModal()">ï¼‹ æ–°å¢é …ç›®</button>
      </div>
    </div>
    <div class="content">
      <div class="admin-toolbar">
        <input type="text" class="finput" style="width:240px" id="admin-search" placeholder="æœå°‹â€¦" oninput="renderAdmin()">
        <select id="admin-axis" class="fsel" style="width:auto" onchange="renderAdmin()"><option value="">å…¨éƒ¨è»¸å‘</option></select>
        <select id="admin-status" class="fsel" style="width:auto" onchange="renderAdmin()">
          <option value="">å…¨éƒ¨ç‹€æ…‹</option>
          <option value="åŸ·è¡Œä¸­">åŸ·è¡Œä¸­</option><option value="å¾…é–‹ç™¼ä¸­">å¾…é–‹ç™¼ä¸­</option>
          <option value="è¦åŠƒä¸­">è¦åŠƒä¸­</option><option value="å®Œæˆ">å®Œæˆ</option><option value="æš«åœ">æš«åœ</option>
        </select>
        <span style="margin-left:auto;font-size:11px;color:var(--gray-400)">å…± <b id="admin-count" style="color:var(--ink);font-family:var(--mono)">0</b> ç­†</span>
      </div>
      <div class="table-wrap">
        <table>
          <thead><tr>
            <th>é …æ¬¡</th><th>äº”å¤§è»¸å‘</th><th>æ¨å‡é …ç›®</th><th>é …ç›®</th><th>é …ç›®é‡é»</th>
            <th>ç¾æ³æŸ¥æ ¸æ©Ÿåˆ¶</th><th>æœªä¾†æŸ¥æ ¸æ©Ÿåˆ¶</th><th>Owner</th><th>ç›®å‰ç‹€æ³</th><th>å‚™è¨»</th><th>æ“ä½œ</th>
          </tr></thead>
          <tbody id="admin-tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- LOG -->

  <div id="page-log" class="page">
    <div class="page-banner">
      <div class="pb-left"><div class="pb-bar"></div><div><div class="pb-eye">Audit Trail</div><div class="pb-title">æ“ä½œè¨˜éŒ„</div><div class="pb-sub">å®Œæ•´æ“ä½œæ­·ç¨‹ç´€éŒ„</div></div></div>
      <div class="pb-actions"><button class="btn btn-ghost btn-sm" onclick="if(confirm('ç¢ºå®šæ¸…é™¤æ‰€æœ‰è¨˜éŒ„ï¼Ÿ')){logs=[];saveLogs();renderLog()}">æ¸…é™¤è¨˜éŒ„</button></div>
    </div>
    <div class="content">
      <div class="log-wrap">
        <div class="log-hdr"><div class="log-hdr-lbl">æœ€æ–°æ“ä½œåœ¨æœ€ä¸Šæ–¹</div></div>
        <div class="log-body" id="log-list"></div>
      </div>
    </div>
  </div>

  <!-- SETTINGS -->

  <div id="page-settings" class="page">
    <div class="page-banner">
      <div class="pb-left"><div class="pb-bar"></div><div><div class="pb-eye">System</div><div class="pb-title">ç³»çµ±è¨­å®š</div><div class="pb-sub">ç®¡ç†å“¡å¯†ç¢¼è¨­å®š</div></div></div>
    </div>
    <div class="content">
      <div class="sp">
        <div class="sp-hdr"><span style="color:var(--red);font-size:15px">ğŸ”</span><div class="sp-hdr-title">ä¿®æ”¹ç®¡ç†å“¡å¯†ç¢¼</div></div>
        <div class="sp-body">
          <p>ä¿®æ”¹å¾Œè«‹å‹™å¿…è¨˜ä½æ–°å¯†ç¢¼ï¼Œå¯†ç¢¼å„²å­˜æ–¼æœ¬æ©Ÿç€è¦½å™¨ï¼Œå»ºè­°è¨­å®šåŒ…å«è‹±æ•¸å­—çµ„åˆçš„å¼·å¼å¯†ç¢¼ã€‚</p>
          <div class="fgrp" style="margin-bottom:13px"><label class="flbl">ç›®å‰å¯†ç¢¼</label><input type="password" class="finput" id="pw-current" placeholder="è¼¸å…¥ç›®å‰å¯†ç¢¼"></div>
          <div class="fgrp" style="margin-bottom:13px"><label class="flbl">æ–°å¯†ç¢¼ <span style="color:var(--red)">*</span></label><input type="password" class="finput" id="pw-new" placeholder="è‡³å°‘ 6 å€‹å­—å…ƒ"></div>
          <div class="fgrp" style="margin-bottom:16px"><label class="flbl">ç¢ºèªæ–°å¯†ç¢¼ <span style="color:var(--red)">*</span></label><input type="password" class="finput" id="pw-confirm" placeholder="å†æ¬¡è¼¸å…¥æ–°å¯†ç¢¼"></div>
          <div class="pw-err" id="pw-error"></div>
          <button class="btn btn-blk" onclick="changePassword()">å„²å­˜æ–°å¯†ç¢¼</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MODAL: ITEM -->

<div class="modal-overlay" id="modal-item">
  <div class="modal">
    <div class="modal-header">
      <div class="m-bar"></div>
      <div class="m-title" id="modal-title">æ–°å¢æ¨å‡é …ç›®</div>
      <button class="m-close" onclick="closeModal('modal-item')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="fg">
        <div class="fgrp"><label class="flbl">é …æ¬¡ <span class="req">*</span></label><input type="text" class="finput" id="f-id" placeholder="å¦‚ï¼š1-1ã€2-3"></div>
        <div class="fgrp"><label class="flbl">ç›®å‰ç‹€æ³ <span class="req">*</span></label>
          <select class="fsel" id="f-status">
            <option value="åŸ·è¡Œä¸­">åŸ·è¡Œä¸­</option><option value="å¾…é–‹ç™¼ä¸­">å¾…é–‹ç™¼ä¸­</option>
            <option value="è¦åŠƒä¸­">è¦åŠƒä¸­</option><option value="å®Œæˆ">å®Œæˆ</option><option value="æš«åœ">æš«åœ</option>
          </select>
        </div>
        <div class="fgrp"><label class="flbl">äº”å¤§è»¸å‘è­°é¡Œ <span class="req">*</span></label>
          <select class="fsel" id="f-axis">
            <option value="å®‰å…¨æ–‡åŒ–ã€æ„è­˜æå‡">å®‰å…¨æ–‡åŒ–ã€æ„è­˜æå‡</option>
            <option value="ç¡¬é«”å‡ç´šã€å¥åº·å®ˆè­·">ç¡¬é«”å‡ç´šã€å¥åº·å®ˆè­·</option>
            <option value="æ¶ˆé™¤æ€ç¶­ã€å·¥æ³•é©æ–°">æ¶ˆé™¤æ€ç¶­ã€å·¥æ³•é©æ–°</option>
            <option value="ç§‘æŠ€è¼”åŠ©ã€AIè³¦èƒ½">ç§‘æŠ€è¼”åŠ©ã€AIè³¦èƒ½</option>
            <option value="å…¶ä»–">å…¶ä»–</option>
          </select>
        </div>
        <div class="fgrp"><label class="flbl">æ¨å‡é …ç›® <span class="req">*</span></label><input type="text" class="finput" id="f-push" placeholder="æ¨å‡é …ç›®åç¨±"></div>
        <div class="fgrp full"><label class="flbl">é …ç›® <span class="req">*</span></label><input type="text" class="finput" id="f-title" placeholder="é …ç›®åç¨±"></div>
        <div class="fgrp full"><label class="flbl">é …ç›®é‡é»</label><textarea class="ftextarea" id="f-point" placeholder="èªªæ˜æ­¤é …ç›®çš„é‡é»å…§å®¹â€¦"></textarea></div>
        <div class="fgrp full"><label class="flbl">ç¾æ³æŸ¥æ ¸æ©Ÿåˆ¶</label><textarea class="ftextarea" id="f-current-mech" placeholder="ç›®å‰çš„æŸ¥æ ¸æ–¹å¼â€¦"></textarea></div>
        <div class="fgrp full"><label class="flbl">æœªä¾†æŸ¥æ ¸æ©Ÿåˆ¶</label><textarea class="ftextarea" id="f-future-mech" placeholder="æœªä¾†è¦åŠƒçš„æŸ¥æ ¸æ–¹å¼â€¦"></textarea></div>
        <div class="fgrp"><label class="flbl">Owner <span class="req">*</span></label><input type="text" class="finput" id="f-owner" placeholder="è² è²¬äººå§“å"></div>
        <div class="fgrp full"><label class="flbl">å‚™è¨»</label><textarea class="ftextarea" id="f-notes" placeholder="è£œå……èªªæ˜ã€ç›¸é—œéƒ¨é–€ã€æ³¨æ„äº‹é …â€¦"></textarea></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-item')">å–æ¶ˆ</button>
      <button class="btn btn-blk" id="modal-save-btn" onclick="saveItem()">å„²å­˜</button>
    </div>
  </div>
</div>

<!-- MODAL: CONFIRM -->

<div class="modal-overlay" id="modal-confirm">
  <div class="modal" style="max-width:400px">
    <div class="modal-header">
      <div class="m-bar"></div>
      <div class="m-title" id="confirm-title">ç¢ºèªæ“ä½œ</div>
      <button class="m-close" onclick="closeModal('modal-confirm')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="cmsg" id="confirm-msg"></div>
      <div class="csub" id="confirm-sub"></div>
      <div class="cwarn" id="confirm-warn" style="display:none"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-confirm')">å–æ¶ˆ</button>
      <button class="btn" id="confirm-ok-btn" onclick="confirmAction()">ç¢ºèª</button>
    </div>
  </div>
</div>

<div class="toast-wrap" id="toast-wrap"></div>

<script>
// â”€â”€ AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DEFAULT_PW='admin1234';
let currentRole=null;
function getPW(){return localStorage.getItem('osh2_pw')||DEFAULT_PW}
function switchTab(t){
  document.querySelectorAll('.l-tab').forEach((el,i)=>el.classList.toggle('active',['guest','admin'][i]===t));
  document.getElementById('lf-guest').classList.toggle('show',t==='guest');
  document.getElementById('lf-admin').classList.toggle('show',t==='admin');
  document.getElementById('login-error').classList.remove('show');
}
function enterAsGuest(){currentRole='guest';enterApp()}
function doLogin(){
  const pw=document.getElementById('admin-pw-input').value;
  if(pw===getPW()){currentRole='admin';document.getElementById('admin-pw-input').value='';enterApp()}
  else{document.getElementById('login-error').classList.add('show');document.getElementById('admin-pw-input').select()}
}
function enterApp(){
  document.getElementById('login-screen').style.display='none';
  document.getElementById('main-app').classList.add('visible');
  applyRole();init();
}
function logout(){
  currentRole=null;
  document.getElementById('login-screen').style.display='flex';
  document.getElementById('main-app').classList.remove('visible');
  document.getElementById('admin-pw-input').value='';
  document.getElementById('login-error').classList.remove('show');
  currentAxisFilter='';currentStatusFilter='';
  showPage('dashboard');
}
function applyRole(){
  const isAdmin=currentRole==='admin';
  document.querySelectorAll('.admin-only').forEach(el=>el.style.display=isAdmin?'flex':'none');
  const b=document.getElementById('role-badge');
  b.className='nav-role '+(isAdmin?'admin':'guest');
  document.getElementById('role-lbl').textContent=isAdmin?'ç®¡ç†å“¡':'è¨ªå®¢';
  document.getElementById('btn-add').style.display=isAdmin?'inline-flex':'none';
  document.getElementById('guest-notice').style.display=isAdmin?'none':'flex';
}
function changePassword(){
  const cur=document.getElementById('pw-current').value;
  const nw=document.getElementById('pw-new').value;
  const cf=document.getElementById('pw-confirm').value;
  const e=document.getElementById('pw-error');e.classList.remove('show');
  if(cur!==getPW()){e.textContent='ç›®å‰å¯†ç¢¼éŒ¯èª¤ã€‚';e.classList.add('show');return}
  if(nw.length<6){e.textContent='æ–°å¯†ç¢¼è‡³å°‘éœ€è¦ 6 å€‹å­—å…ƒã€‚';e.classList.add('show');return}
  if(nw!==cf){e.textContent='å…©æ¬¡å¯†ç¢¼ä¸ä¸€è‡´ã€‚';e.classList.add('show');return}
  localStorage.setItem('osh2_pw',nw);
  ['pw-current','pw-new','pw-confirm'].forEach(id=>document.getElementById(id).value='');
  toast('ç®¡ç†å“¡å¯†ç¢¼å·²æˆåŠŸä¿®æ”¹','success');addLog('edit','ä¿®æ”¹ç®¡ç†å“¡å¯†ç¢¼');
}

// â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let items=[], logs=[];
let currentAxisFilter='', currentStatusFilter='';
function uid(){return Date.now().toString(36)+Math.random().toString(36).slice(2,6)}

const AXIS_COLORS={
  'å®‰å…¨æ–‡åŒ–ã€æ„è­˜æå‡':'#c0112e',
  'ç¡¬é«”å‡ç´šã€å¥åº·å®ˆè­·':'#16603a',
  'æ¶ˆé™¤æ€ç¶­ã€å·¥æ³•é©æ–°':'#b84e00',
  'ç§‘æŠ€è¼”åŠ©ã€AIè³¦èƒ½':'#0e3d9e',
  'å…¶ä»–':'#5a5a58'
};

function defaultItems(){
  return [
    {id:'i1',itemId:'1-1',axis:'å®‰å…¨æ–‡åŒ–ã€æ„è­˜æå‡',push:'ä¸€æ¬¡å·¥å…·ç®±æœƒè­°',title:'æ‰€æœ‰å…¥å» æ–½å·¥',point:'PPEé…æˆ´åŠé«”æº«ç¨½æŸ¥æ ¸',currentMech:'ç•¶æ—¥æ¨™ç±¤ç®¡åˆ¶(ç‰¹å€)',futureMech:'',owner:'åš´åƒåª„',status:'åŸ·è¡Œä¸­',notes:''},
    {id:'i2',itemId:'1-2',axis:'å®‰å…¨æ–‡åŒ–ã€æ„è­˜æå‡',push:'æå‡è­¦å‹¤çš„å°ˆæ¥­',title:'ç´å…¥TSMC å¯¦é«”å®‰å…¨è¦ç¯„æ¨™æº–',point:'TSMCç›´æ¥ç™¼åŒ…',currentMech:'CPSDç£å°æŸ¥æ ¸',futureMech:'',owner:'æ—å›ç©',status:'åŸ·è¡Œä¸­',notes:''},
    {id:'i3',itemId:'1-3',axis:'å®‰å…¨æ–‡åŒ–ã€æ„è­˜æå‡',push:'æé«˜è¦‹è­¦ç‡',title:'å¢è¨­å€åŸŸå®‰å…¨ç›£æ§èƒ½åŠ›ã€å¢è¨­æ¨“ç®¡å®‰ç®¡äººåŠ›',point:'å¢åŠ å°ˆæ¥­å®‰å…¨ç£å°äººå“¡é§é»(å„å°ˆæ¡ˆç´„å¢åŠ 30äºº)',currentMech:'å…¨é¢è¨­ç½®åŠå¢è£œäººåŠ›',futureMech:'',owner:'æ—å›ç©',status:'åŸ·è¡Œä¸­',notes:'å·²åˆ¶å®šè­·æ¬„æ¨™æº–åŸå‰‡'},
    {id:'i4',itemId:'1-4',axis:'å®‰å…¨æ–‡åŒ–ã€æ„è­˜æå‡',push:'æ¯é€±æ‰¿æ”¬å•†æª¢è¨æ©Ÿåˆ¶',title:'ç¾å ´å®‰å…¨CMæœƒè­°',point:'å·¥åœ°æ—¥å¸¸æŸ¥æ ¸æª¢è¨æœƒè­°',currentMech:'NFSDåŸ·è¡Œä¸­ã€å®‰å…¨ç¸¾æ•ˆæª¢è¨é€šå ±',futureMech:'',owner:'é¡å¹³å’Œ',status:'åŸ·è¡Œä¸­',notes:''},
    {id:'i5',itemId:'1-5',axis:'å®‰å…¨æ–‡åŒ–ã€æ„è­˜æå‡',push:'æ¯é€±æ‰¿æ”¬å•†æª¢è¨æ©Ÿåˆ¶',title:'æ‰¿æ”¬å•†é«˜éšä¸»ç®¡æª¢è¨æœƒè­°',point:'ä¾æ“šå·¥åœ°å®‰å…¨æª¢è¨é€šå ±ã€åš´é‡ç¼ºå¤±æ‰¿æ”¬å•†é«˜éšä¸»ç®¡æª¢è¨',currentMech:'MMåŸ·è¡Œä¸­',futureMech:'',owner:'è˜‡èºæ½”/é¡å¹³å’Œ',status:'åŸ·è¡Œä¸­',notes:''},
    {id:'i6',itemId:'1-6',axis:'å®‰å…¨æ–‡åŒ–ã€æ„è­˜æå‡',push:'äºŒæ¬¡å·¥å…·ç®±æœƒè­°',title:'ä¸ƒå¤§é«˜é¢¨éšªä½œæ¥­',point:'æ–½å·¥å‰ç”³è«‹é«˜é¢¨éšªä½œæ¥­ã€é ˆå…·å‚™ä½œæ¥­ç¨‹åºæ›¸',currentMech:'äººå·¥å·¡æŸ¥',futureMech:'ä½œæ¥­ç¨‹åºç®¡åˆ¶ã€ä»‹é¢æŸ¥æ ¸ç®¡ç†',owner:'è˜‡èºæ½”',status:'å¾…é–‹ç™¼ä¸­',notes:'ç¨‹åºç®¡åˆ¶URD: NFSDã€ç¨‹åºç®¡åˆ¶å¹³å°é–‹ç™¼: IT'},
    {id:'i7',itemId:'1-7',axis:'å®‰å…¨æ–‡åŒ–ã€æ„è­˜æå‡',push:'å®‰å…¨æ•™è‚²',title:'16é–€èª²ç¨‹ä¾å·¥ç¨®åŠè§’è‰²è¨“ç·´',point:'2å¹´æœŸçš„å›è¨“æ©Ÿåˆ¶ã€äººè³‡è³‡æ–™åº«å®Œè¨“å»ºæª”',currentMech:'ç™¼å±•å¿…è¦é …ç›®ã€äººå·¥æŠ½æŸ¥',futureMech:'é€¾æœŸäº‹å‰è­¦ç¤º/åˆ°æœŸé–å¡',owner:'è˜‡èºæ½”',status:'å¾…é–‹ç™¼ä¸­',notes:'èª²ç¨‹é–‹ç™¼: ESHã€è³‡æ–™åº«è‡ªå‹•åŒ–: IT'},
    {id:'i8',itemId:'1-8',axis:'å®‰å…¨æ–‡åŒ–ã€æ„è­˜æå‡',push:'é«”æ„Ÿè¨“ç·´',title:'9é …é«”æ„Ÿè¨­æ–½',point:'å¹´åº¦è¦åŠƒ(å®¶å±¬ã€é•·å®˜ã€åŒå„•...)',currentMech:'ç™¼å±•å¿…è¦é …ç›®ã€äººå·¥æŠ½æŸ¥',futureMech:'é€¾æœŸäº‹å‰è­¦ç¤º/åˆ°æœŸé–å¡',owner:'é»ƒä¸–å˜‰',status:'å¾…é–‹ç™¼ä¸­',notes:'èª²ç¨‹é–‹ç™¼: NFSDã€è³‡æ–™åº«è‡ªå‹•åŒ–: IT'},
    {id:'i9',itemId:'2-1',axis:'ç¡¬é«”å‡ç´šã€å¥åº·å®ˆè­·',push:'ç¾å ´æ¨™ç¤ºè­˜åˆ¥',title:'é«˜é¢¨éšªæ–½å·¥å€ã€ä¼‘æ¯å€ã€å»æ‰€ã€äººè»Šå‹•ç·š...',point:'ä¾ç…§ISO7010åŠISO3864å®‰å…¨æ¨™èªŒåˆ¶å®šè¦ç¯„',currentMech:'NFSDåŸ·è¡Œä¸­',futureMech:'',owner:'æ¥Šæ›¸ä¿®',status:'åŸ·è¡Œä¸­',notes:''},
    {id:'i10',itemId:'2-2',axis:'ç¡¬é«”å‡ç´šã€å¥åº·å®ˆè­·',push:'äººè»Šåˆ†é“',title:'å¯¦é«”å€éš”(åœç±¬ã€Aå­—å½¢è­·æ¬„ã€GIPè­·æ¬„)',point:'ç¶­æŒæ·¨ç©ºã€ç„¡æ“ºæ”¾ç‰©æ–™',currentMech:'å°–å³°æ™‚æ®µäººè»Šäº¤ç¹”å€å¢è£œäº¤ç®¡äººåŠ›',futureMech:'',owner:'CD-1 ææ–‡å‚‘',status:'åŸ·è¡Œä¸­',notes:''},
    {id:'i11',itemId:'2-3',axis:'ç¡¬é«”å‡ç´šã€å¥åº·å®ˆè­·',push:'é™¶å£é€£é«”æµ´å»',title:'é™¶å£é€£é«”æµ´å»',point:'å·¥ä½œå‹•ç·šè©•ä¼°ã€å‹è³‡é›™æ–¹ç°½ç½²æ´¾å·¥åŒæ„æ›¸',currentMech:'NFSDåŸ·è¡Œä¸­',futureMech:'',owner:'åš´åƒåª„',status:'åŸ·è¡Œä¸­',notes:''},
    {id:'i12',itemId:'2-4',axis:'ç¡¬é«”å‡ç´šã€å¥åº·å®ˆè­·',push:'è»Šè¼›ä¸»å‹•é˜²è­·',title:'ç‡Ÿå»ºç³»è»Šè¼›æ©Ÿæ¢°',point:'360åº¦ç’°æ™¯å½±åƒã€ç’°æ™¯è­¦ç¤ºç‡ˆã€å€’è»Šé›·é”ã€å°è»Šé¡¯å½±ã€å€’è»Šè­¦ç¤ºèœ‚é³´ã€é˜²æ’è­·æ¬„',currentMech:'NFSDåŸ·è¡Œä¸­ã€å…¥å» å¿…è¦é …ç›®',futureMech:'',owner:'CD-2 å³æ–‡å¾·',status:'åŸ·è¡Œä¸­',notes:''},
    {id:'i13',itemId:'2-5',axis:'ç¡¬é«”å‡ç´šã€å¥åº·å®ˆè­·',push:'é–‹å£é˜²è­·',title:'æ¨“æ¿é–‹å£ã€åŠè£å¹³å°é–‹å£ã€é›»æ¢¯äº•ã€CRåŠè£é–‹å£ã€CRå¤©èŠ±æ¿é–‹å£ã€MEPæª¢ä¿®é–‹å£',point:'æ¯æ—¥æª¢é»ç¶­è­·ã€æ°´å¹³åŠç«‹é¢å®‰å…¨ç¶²ã€è¸æ¿è™•ã€å±éšªæ¨™ç¤ºã€Oå‹ç’°ã€å°å‹é–‹å£èˆ‡è‚‡äº‹å­”ã€æ¨“æ¢¯è¸æ¿å¼±å¾Œé–‹å£é˜²è­·å·¥æ³•',currentMech:'äººå·¥å·¡æŸ¥',futureMech:'ä½œæ¥­ç¨‹åºç®¡åˆ¶ã€ä»‹é¢æŸ¥æ ¸ç®¡ç†',owner:'æä¿Šéœ†',status:'å¾…é–‹ç™¼ä¸­',notes:'ç¨‹åºç®¡åˆ¶URD: NFSD'},
    {id:'i14',itemId:'2-6',axis:'ç¡¬é«”å‡ç´šã€å¥åº·å®ˆè­·',push:'åŠæ›ä½œæ¥­é˜²è­·',title:'å…¨åŠè»ŠåŠæ›ä½œæ¥­',point:'QRç®¡åˆ¶ã€å‹•å·¥/å·¥å®‰å…¨ç¨‹ç›£ç£',currentMech:'äººå·¥å·¡æŸ¥',futureMech:'ä½œæ¥­ç¨‹åºç®¡åˆ¶ã€ä»‹é¢æŸ¥æ ¸ç®¡ç†',owner:'æä¿Šéœ†',status:'å¾…é–‹ç™¼ä¸­',notes:'ç¨‹åºç®¡åˆ¶URD: NFSDã€ç¨‹åºç®¡åˆ¶å¹³å°é–‹ç™¼'},
    {id:'i15',itemId:'3-1',axis:'æ¶ˆé™¤æ€ç¶­ã€å·¥æ³•é©æ–°',push:'ç©ºèª¿æ¨¡çµ„å·¥ç¨‹',title:'PCWã€ç©ºèª¿ç®±æ¨¡çµ„é çµ„',point:'å ´å¤–é çµ„å¾Œé‹åˆ°ç¾å ´çµ„è£',currentMech:'NFCDæŸ¥æ ¸',futureMech:'',owner:'æ—ç¾©å‡±',status:'åŸ·è¡Œä¸­',notes:''},
    {id:'i16',itemId:'3-2',axis:'æ¶ˆé™¤æ€ç¶­ã€å·¥æ³•é©æ–°',push:'å†·å»æ°´å¡”å·¥ç¨‹',title:'å†·å»æ°´å¡”å·¥ç¨‹é çµ„',point:'å†·å»æ°´å¡”åœ¨åœ°çµ„è£å¾Œï¼ŒåŠæ¥è‡³RFå†·å»æ°´å¡”çµ„è£',currentMech:'NFCD Sponsor Lvlæ–½å·¥ç¾å ´ç›£ç£ã€ç¾å ´å³æ™‚æ”å½±ç›£è¦–',futureMech:'',owner:'æ—ç¾©å‡±',status:'åŸ·è¡Œä¸­',notes:''},
    {id:'i17',itemId:'4-1',axis:'ç§‘æŠ€è¼”åŠ©ã€AIè³¦èƒ½',push:'AIå½±åƒç›£è¦–',title:'AIå½±åƒç›£è¦–(PPEå®Œå–„æ€§ã€å€åŸŸç ´å£ã€é•è¦ä½œæ¥­ç¨‹åº)',point:'ç›£è¦–æ”å½±æ©Ÿå…¨æ™‚ç´€éŒ„',currentMech:'å»ºç½®å®Œæ•´ç¶²è·¯æ¶æ§‹ï¼Œæ”¶è¨Šç„¡æ­»è§’ï¼Œè³¼è²·å³æ™‚æ”å½±æ©Ÿ',futureMech:'äººå·¥ç¶²è·¯è¨Šè™Ÿæ¸¬è©¦',owner:'å»–å¿—å€«/é¾å•Ÿç¥¥',status:'åŸ·è¡Œä¸­',notes:'ç¶²è·¯æ¸¬è©¦: ITã€è¨­å‚™è³¼è²·: NFSD'},
  ];
}

function loadData(){
  try{
    const si=localStorage.getItem('osh2_items');
    const sl=localStorage.getItem('osh2_logs');
    items=si?JSON.parse(si):defaultItems();
    logs=sl?JSON.parse(sl):[];
  }catch(e){items=defaultItems();logs=[]}
}
function saveItems(){try{localStorage.setItem('osh2_items',JSON.stringify(items))}catch(e){}}
function saveLogs(){try{localStorage.setItem('osh2_logs',JSON.stringify(logs))}catch(e){}}
function addLog(type,msg){logs.unshift({type,msg,time:new Date().toLocaleString('zh-TW')});if(logs.length>300)logs.pop();saveLogs()}

// â”€â”€ UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPage(name){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('page-'+name).classList.add('active');
  document.querySelectorAll('.nav-tab').forEach((t,i)=>t.classList.toggle('active',['dashboard','admin','log','settings'][i]===name));
  if(name==='dashboard')renderDashboard();
  if(name==='admin')renderAdmin();
  if(name==='log')renderLog();
}
function openModal(id){document.getElementById(id).classList.add('open')}
function closeModal(id){document.getElementById(id).classList.remove('open')}
document.querySelectorAll('.modal-overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('open')}));
function toast(msg,type='info'){
  const icons={success:'âœ“',error:'âœ—',info:'i'};
  const el=document.createElement('div');
  el.className=`toast ${type}`;
  el.innerHTML=`<span class="ti">${icons[type]}</span>${msg}`;
  document.getElementById('toast-wrap').appendChild(el);
  setTimeout(()=>{el.style.opacity='0';el.style.transform='translateX(10px)';el.style.transition='all .28s';setTimeout(()=>el.remove(),300)},3000);
}

// â”€â”€ AXIS TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildAxisTabs(){
  const axes=[...new Set(items.map(i=>i.axis))].sort();
  const container=document.getElementById('axis-tabs');
  let html=`<button class="axis-tab ${currentAxisFilter===''?'active':''}" onclick="filterByAxis('')">å…¨éƒ¨è»¸å‘</button>`;
  axes.forEach(ax=>{
    const color=AXIS_COLORS[ax]||'#5a5a58';
    html+=`<button class="axis-tab ${currentAxisFilter===ax?'active':''}" onclick="filterByAxis('${ax}')" style="${currentAxisFilter===ax?`background:${color};color:#fff;border-color:${color}`:'color:'+color}">${ax}</button>`;
  });
  container.innerHTML=html;
}
function filterByAxis(ax){currentAxisFilter=ax;renderDashboard()}
function filterByStatus(st){
  currentStatusFilter=st;
  document.getElementById('db-status').value=st;
  renderDashboard();
}

// â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderStats(){
  document.getElementById('s-total').textContent=items.length;
  document.getElementById('s-exec').textContent=items.filter(i=>i.status==='åŸ·è¡Œä¸­').length;
  document.getElementById('s-pending').textContent=items.filter(i=>i.status==='å¾…é–‹ç™¼ä¸­').length;
  document.getElementById('s-dev').textContent=items.filter(i=>i.status==='è¦åŠƒä¸­').length;
  document.getElementById('s-plan').textContent=items.filter(i=>i.status==='å®Œæˆ').length;
}
function renderDashboard(){
  renderStats();buildAxisTabs();
  const search=document.getElementById('db-search').value.toLowerCase();
  const owner=document.getElementById('db-owner').value;
  const status=document.getElementById('db-status').value||currentStatusFilter;

  let f=items.filter(i=>{
    if(currentAxisFilter&&i.axis!==currentAxisFilter)return false;
    if(search&&!i.title.toLowerCase().includes(search)&&!i.point.toLowerCase().includes(search)&&!i.push.toLowerCase().includes(search))return false;
    if(owner&&i.owner!==owner)return false;
    if(status&&i.status!==status)return false;
    return true;
  });

  const SO={'åŸ·è¡Œä¸­':0,'å¾…é–‹ç™¼ä¸­':1,'è¦åŠƒä¸­':2,'å®Œæˆ':3,'æš«åœ':4};
  f.sort((a,b)=>{
    const sa=SO[a.status]??99,sb=SO[b.status]??99;
    if(sa!==sb)return sa-sb;
    return a.itemId.localeCompare(b.itemId);
  });

  document.getElementById('db-count').textContent=f.length;
  document.getElementById('db-total').textContent=items.length;

  const grid=document.getElementById('dashboard-grid');
  if(!f.length){grid.innerHTML=`<div class="empty-s"><span class="empty-s-icon">â€” â—‹ â€”</span><div class="empty-s-text">ç„¡ç¬¦åˆæ¢ä»¶ä¹‹é …ç›®</div></div>`;return}

  // Group by status
  const groups={};
  f.forEach(i=>{if(!groups[i.status])groups[i.status]=[];groups[i.status].push(i)});
  const SC={'åŸ·è¡Œä¸­':'var(--green)','å¾…é–‹ç™¼ä¸­':'var(--blue)','è¦åŠƒä¸­':'var(--purple)','å®Œæˆ':'var(--gray-300)','æš«åœ':'var(--orange)'};
  let html='';
  ['åŸ·è¡Œä¸­','å¾…é–‹ç™¼ä¸­','è¦åŠƒä¸­','å®Œæˆ','æš«åœ'].forEach(s=>{
    if(groups[s]){
      html+=`<div class="sec-div" style="background:var(--off)">
        <div class="sec-bar" style="background:${SC[s]}"></div>
        <div class="sec-lbl" style="color:${SC[s]}">${s}</div>
        <div class="sec-line"></div>
        <div class="sec-cnt">${groups[s].length} é …</div>
      </div>`;
      html+=groups[s].map(renderCard).join('');
    }
  });
  grid.innerHTML=html;
}

function renderCard(item){
  const isAdmin=currentRole==='admin';
  const axColor=AXIS_COLORS[item.axis]||'#5a5a58';
  return`<div class="item-card">
    <div class="card-head">
      <div class="card-ab s-${item.status}"></div>
      <div class="card-hc">
        <span class="card-id">${item.itemId}</span>
        <div class="card-title">${item.title}</div>
        <span class="schip sc-${item.status}">${item.status}</span>
      </div>
    </div>
    <div class="card-body">
      <div class="card-axis" style="color:${axColor}">${item.axis}</div>
      <div class="card-meta">
        <div class="mi"><div class="mk">æ¨å‡é …ç›®</div><div class="mv">${item.push}</div></div>
        <div class="mi"><div class="mk">Owner</div><div class="mv">${item.owner}</div></div>
      </div>
      ${item.point?`<div class="card-detail"><div class="cd-label">é …ç›®é‡é»</div><div class="cd-val">${item.point}</div></div>`:''}
      ${item.currentMech?`<div class="card-detail"><div class="cd-label">ç¾æ³æŸ¥æ ¸æ©Ÿåˆ¶</div><div class="cd-val">${item.currentMech}</div></div>`:''}
      ${item.futureMech?`<div class="card-detail"><div class="cd-label">æœªä¾†æŸ¥æ ¸æ©Ÿåˆ¶</div><div class="cd-val highlight">${item.futureMech}</div></div>`:''}
      ${item.notes?`<div class="card-notes">ğŸ“Œ ${item.notes}</div>`:''}
    </div>
    <div class="card-foot">
      <span class="owner-tag">ğŸ‘¤ ${item.owner}</span>
      <div class="card-acts">
        ${isAdmin?`<button class="bti e" title="ç·¨è¼¯" onclick="openEditModal('${item.id}')">âœ</button><button class="bti d" title="åˆªé™¤" onclick="askDelete('${item.id}')">ğŸ—‘</button>`:''}
      </div>
    </div>
  </div>`;
}

// â”€â”€ ADMIN TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 
function renderAdmin(){
  const search=document.getElementById('admin-search').value.toLowerCase();
  const axis=document.getElementById('admin-axis').value;
  const status=document.getElementById('admin-status').value;
  let f=items.filter(i=>{
    if(search&&!i.title.toLowerCase().includes(search)&&!i.push.toLowerCase().includes(search)&&!i.owner.toLowerCase().includes(search)&&!i.itemId.toLowerCase().includes(search))return false;
    if(axis&&i.axis!==axis)return false;
    if(status&&i.status!==status)return false;
    return true;
  });
  f.sort((a,b)=>a.itemId.localeCompare(b.itemId));
  document.getElementById('admin-count').textContent=f.length;
  const SM={'åŸ·è¡Œä¸­':'sc-åŸ·è¡Œä¸­','å¾…é–‹ç™¼ä¸­':'sc-å¾…é–‹ç™¼ä¸­','è¦åŠƒä¸­':'sc-è¦åŠƒä¸­','å®Œæˆ':'sc-å®Œæˆ','æš«åœ':'sc-æš«åœ'};
  const tbody=document.getElementById('admin-tbody');
  if(!f.length){tbody.innerHTML=`<tr><td colspan="11" style="text-align:center;color:var(--gray-400);padding:36px;font-size:12px">ç„¡ç¬¦åˆæ¢ä»¶ä¹‹é …ç›®</td></tr>`;return}
  tbody.innerHTML=f.map(item=>`<tr>
    <td class="td-id">${item.itemId}</td>
    <td class="td-axis">${item.axis}</td>
    <td class="td-push">${item.push}</td>
    <td class="td-title">${item.title}</td>
    <td class="td-point">${item.point||'â€”'}</td>
    <td class="td-mech">${item.currentMech||'â€”'}</td>
    <td class="td-mech">${item.futureMech||'â€”'}</td>
    <td><span class="td-owner">${item.owner}</span></td>
    <td><span class="schip ${SM[item.status]||''}" style="font-size:9px">${item.status}</span></td>
    <td class="td-notes">${item.notes||'â€”'}</td>
    <td><div class="td-acts">
      <button class="bti e" title="ç·¨è¼¯" onclick="openEditModal('${item.id}')">âœ</button>
      <button class="bti d" title="åˆªé™¤" onclick="askDelete('${item.id}')">ğŸ—‘</button>
    </div></td>
  </tr>`).join('');
}

// â”€â”€ LOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderLog(){
  const el=document.getElementById('log-list');
  if(!logs.length){el.innerHTML=`<div style="padding:22px 0;color:var(--gray-300);font-size:12px">å°šç„¡æ“ä½œè¨˜éŒ„</div>`;return}
  el.innerHTML=logs.map(l=>`<div class="log-item">
    <div class="log-dot ${l.type}"></div>
    <div><div class="log-msg">${l.msg}</div><div class="log-time">${l.time}</div></div>
  </div>`).join('');
}

// â”€â”€ EXCEL EXPORT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportExcel(){
  const ds=new Date().toISOString().slice(0,10).replace(/-/g,'');
  const hdr=['é …æ¬¡','äº”å¤§è»¸å‘è­°é¡Œ','æ¨å‡é …ç›®','é …ç›®','é …ç›®é‡é»','ç¾æ³æŸ¥æ ¸æ©Ÿåˆ¶','æœªä¾†æŸ¥æ ¸æ©Ÿåˆ¶','Owner','ç›®å‰ç‹€æ³','å‚™è¨»'];
  const rows=items.map(i=>[i.itemId,i.axis,i.push,i.title,i.point,i.currentMech,i.futureMech,i.owner,i.status,i.notes]);
  const wb=XLSX.utils.book_new();
  const w1=XLSX.utils.aoa_to_sheet([hdr,...rows]);
  w1['!cols']=[{wch:8},{wch:20},{wch:18},{wch:30},{wch:35},{wch:30},{wch:25},{wch:15},{wch:10},{wch:30}];
  XLSX.utils.book_append_sheet(wb,w1,'æ‰€æœ‰é …ç›®');

  // By axis sheets
  const axes=[...new Set(items.map(i=>i.axis))];
  axes.forEach(ax=>{
    const axItems=items.filter(i=>i.axis===ax);
    const ws=XLSX.utils.aoa_to_sheet([hdr,...axItems.map(i=>[i.itemId,i.axis,i.push,i.title,i.point,i.currentMech,i.futureMech,i.owner,i.status,i.notes])]);
    ws['!cols']=w1['!cols'];
    XLSX.utils.book_append_sheet(wb,ws,ax.substring(0,12));
  });

  // Summary
  const SC={'åŸ·è¡Œä¸­':0,'å¾…é–‹ç™¼ä¸­':0,'è¦åŠƒä¸­':0,'å®Œæˆ':0,'æš«åœ':0};
  items.forEach(i=>{if(SC[i.status]!==undefined)SC[i.status]++});
  const ownerCount={};items.forEach(i=>{ownerCount[i.owner]=(ownerCount[i.owner]||0)+1});
  const sum=[
    ['è·å®‰è¡›æ¨å‡é …ç›®ç®¡ç†ç³»çµ± â€” åŒ¯å‡ºå ±è¡¨'],
    ['åŒ¯å‡ºæ™‚é–“',new Date().toLocaleString('zh-TW')],[''],
    ['ã€ç‹€æ…‹çµ±è¨ˆã€‘',''],
    ['é …ç›®ç¸½æ•¸',items.length],
    ...Object.entries(SC).map(([s,c])=>[s,c]),[''],
    ['ã€äº”å¤§è»¸å‘åˆ†å¸ƒã€‘',''],
    ...axes.map(ax=>[ax,items.filter(i=>i.axis===ax).length]),[''],
    ['ã€Owner é …ç›®æ•¸ã€‘',''],
    ...Object.entries(ownerCount).sort((a,b)=>b[1]-a[1]).map(([o,c])=>[o,c]),
  ];
  const ws=XLSX.utils.aoa_to_sheet(sum);ws['!cols']=[{wch:30},{wch:12}];
  XLSX.utils.book_append_sheet(wb,ws,'çµ±è¨ˆæ‘˜è¦');
  XLSX.writeFile(wb,`è·å®‰è¡›æ¨å‡é …ç›®å ±è¡¨_${ds}.xlsx`);
  toast('Excel å ±è¡¨åŒ¯å‡ºæˆåŠŸ','success');
  if(currentRole==='admin')addLog('edit','åŒ¯å‡º Excel å ±è¡¨');
}

// â”€â”€ ADD / EDIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let editingId=null;
function openAddModal(){
  if(currentRole!=='admin'){toast('è¨ªå®¢ç„¡æ³•æ–°å¢é …ç›®','error');return}
  editingId=null;
  document.getElementById('modal-title').textContent='æ–°å¢æ¨å‡é …ç›®';
  document.getElementById('modal-save-btn').textContent='æ–°å¢';
  clearForm();openModal('modal-item');
}
function openEditModal(id){
  if(currentRole!=='admin'){toast('è¨ªå®¢ç„¡æ³•ç·¨è¼¯','error');return}
  const item=items.find(i=>i.id===id);if(!item)return;
  editingId=id;
  document.getElementById('modal-title').textContent='ç·¨è¼¯é …ç›®';
  document.getElementById('modal-save-btn').textContent='å„²å­˜è®Šæ›´';
  document.getElementById('f-id').value=item.itemId;
  document.getElementById('f-axis').value=item.axis;
  document.getElementById('f-push').value=item.push;
  document.getElementById('f-title').value=item.title;
  document.getElementById('f-point').value=item.point||'';
  document.getElementById('f-current-mech').value=item.currentMech||'';
  document.getElementById('f-future-mech').value=item.futureMech||'';
  document.getElementById('f-owner').value=item.owner;
  document.getElementById('f-status').value=item.status;
  document.getElementById('f-notes').value=item.notes||'';
  openModal('modal-item');
}
function clearForm(){
  ['f-id','f-push','f-title','f-point','f-current-mech','f-future-mech','f-owner','f-notes'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('f-axis').value='å®‰å…¨æ–‡åŒ–ã€æ„è­˜æå‡';
  document.getElementById('f-status').value='åŸ·è¡Œä¸­';
}
function saveItem(){
  if(currentRole!=='admin'){toast('è¨ªå®¢ç„¡æ³•æ“ä½œ','error');return}
  const itemId=document.getElementById('f-id').value.trim();
  const axis=document.getElementById('f-axis').value;
  const push=document.getElementById('f-push').value.trim();
  const title=document.getElementById('f-title').value.trim();
  const point=document.getElementById('f-point').value.trim();
  const currentMech=document.getElementById('f-current-mech').value.trim();
  const futureMech=document.getElementById('f-future-mech').value.trim();
  const owner=document.getElementById('f-owner').value.trim();
  const status=document.getElementById('f-status').value;
  const notes=document.getElementById('f-notes').value.trim();
  if(!itemId){toast('è«‹å¡«å¯«é …æ¬¡','error');return}
  if(!title){toast('è«‹å¡«å¯«é …ç›®åç¨±','error');return}
  if(!owner){toast('è«‹å¡«å¯« Owner','error');return}
  if(editingId){
    const idx=items.findIndex(i=>i.id===editingId);
    if(idx>=0){items[idx]={...items[idx],itemId,axis,push,title,point,currentMech,futureMech,owner,status,notes};addLog('edit',`ç·¨è¼¯é …ç›®ï¼š${itemId} ${title}`);toast('é …ç›®å·²æ›´æ–°','success')}
  } else {
    items.push({id:uid(),itemId,axis,push,title,point,currentMech,futureMech,owner,status,notes});
    addLog('add',`æ–°å¢é …ç›®ï¼š${itemId} ${title}ï¼ˆ${axis}ï¼‰`);toast('é …ç›®å·²æ–°å¢','success');
  }
  saveItems();closeModal('modal-item');renderDashboard();renderAdmin();populateFilters();
}

// â”€â”€ DELETE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let pendingDelete=null;
function askDelete(id){
  if(currentRole!=='admin'){toast('è¨ªå®¢ç„¡æ³•æ“ä½œ','error');return}
  const item=items.find(i=>i.id===id);if(!item)return;
  pendingDelete=id;
  document.getElementById('confirm-title').textContent='ç¢ºèªåˆªé™¤';
  document.getElementById('confirm-msg').textContent=`åˆªé™¤ã€Œ${item.itemId} ${item.title}ã€ï¼Ÿ`;
  document.getElementById('confirm-sub').textContent='æ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚';
  const w=document.getElementById('confirm-warn');w.textContent='è­¦å‘Šï¼šè³‡æ–™ä¸€ç¶“åˆªé™¤å³ç„¡æ³•æ¢å¾©ã€‚';w.style.display='block';
  const btn=document.getElementById('confirm-ok-btn');btn.textContent='ç¢ºèªåˆªé™¤';btn.className='btn btn-red';
  openModal('modal-confirm');
}
function confirmAction(){
  if(!pendingDelete)return;
  const item=items.find(i=>i.id===pendingDelete);
  if(item){
    const n=`${item.itemId} ${item.title}`;
    items=items.filter(i=>i.id!==pendingDelete);
    saveItems();addLog('del',`åˆªé™¤é …ç›®ï¼š${n}`);toast(`å·²åˆªé™¤ï¼š${n}`,'error');
  }
  pendingDelete=null;closeModal('modal-confirm');renderDashboard();renderAdmin();populateFilters();
}

// â”€â”€ FILTERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function resetFilters(){
  currentAxisFilter='';currentStatusFilter='';
  ['db-search','db-owner','db-status'].forEach(id=>document.getElementById(id).value='');
  renderDashboard();
}
function populateFilters(){
  const owners=[...new Set(items.map(i=>i.owner))].sort();
  const axes=[...new Set(items.map(i=>i.axis))].sort();
  function fill(sid,opts){
    const el=document.getElementById(sid);if(!el)return;
    const cur=el.value,first=el.querySelector('option[value=""]');
    el.innerHTML='';if(first)el.appendChild(first);
    opts.forEach(o=>{const op=document.createElement('option');op.value=o;op.textContent=o;el.appendChild(op)});
    el.value=cur;
  }
  fill('db-owner',owners);fill('admin-axis',axes);
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function init(){
  loadData();
  const d=new Date();
  document.getElementById('todayLabel').textContent=`${d.getFullYear()} å¹´ ${d.getMonth()+1} æœˆ ${d.getDate()} æ—¥  Â·  ä¸­è¯æ°‘åœ‹ ${d.getFullYear()-1911} å¹´`;
  populateFilters();renderDashboard();
}
</script>

</body>
</html>
